# Merge Points（ポイントマージ）

## 概要

Merge Pointsノードは、複数のポイントデータソースを単一のポイントデータ出力にマージ（統合）するノードです。動的入力ピンを持ち、複数のポイントセットを1つにまとめることができます。

**ノードタイプ**: Spatial
**クラス名**: `UPCGMergeSettings`, `FPCGMergeElement`

## 機能詳細

このノードは複数のポイントデータソースを受け取り、それらを単一のポイントデータセットに統合します。メタデータのマージもサポートしており、入力ソースのメタデータ属性を保持することができます。

### 主な特徴

- **動的入力ピン**: 必要に応じて入力ピンを追加可能
- **メタデータのマージ**: 入力データのメタデータ属性を統合
- **ポイント数の集約**: すべての入力ポイントを1つのデータセットに集約

## プロパティ

### bMergeMetadata
- **型**: `bool`
- **デフォルト値**: `true`
- **説明**: マージされたデータにメタデータを含めるかどうかを制御します
- **PCG_Overridable**: 可

## 使用例

### 基本的な使用方法

```
複数のポイント生成ノード → Merge Points → 出力
```

### 実際のワークフロー例

1. **複数ソースの統合**
   - Surface Samplerで地面のポイントを生成
   - Spline Samplerでパスのポイントを生成
   - 両方をMerge Pointsで統合

2. **異なる密度のポイント統合**
   - 高密度エリアと低密度エリアのポイントを別々に生成
   - Merge Pointsで1つのデータセットに統合
   - その後のフィルタリングや処理を適用

## 実装の詳細

### ファイル位置
- **ヘッダー**: `Engine/Plugins/PCG/Source/PCG/Public/Elements/PCGMergeElement.h`
- **実装**: `Engine/Plugins/PCG/Source/PCG/Private/Elements/PCGMergeElement.cpp`

### 継承関係
- `UPCGMergeSettings` ← `UPCGSettingsWithDynamicInputs` ← `UPCGSettings`
- `FPCGMergeElement` ← `IPCGElement`

### ExecuteInternal処理フロー

1. **入力データの収集**: すべての入力ピンからポイントデータを取得
2. **ポイント数の計算**: 総ポイント数を算出
3. **メタデータの準備**: `bMergeMetadata`が有効な場合、メタデータ属性を統合
4. **ポイントのコピー**: すべての入力ポイントをターゲットデータにコピー
5. **出力データの生成**: 統合されたポイントデータを出力

### 入出力仕様

- **入力ピン**:
  - `In` (デフォルト、動的に追加可能)
  - タイプ: `EPCGDataType::Point`

- **出力ピン**:
  - `Out`
  - タイプ: `EPCGDataType::Point`
  - 複数接続不可、複数データ不可

### パフォーマンス特性

- **キャッシュ可能**: デフォルト設定による
- **並列処理**: 統合処理自体は順次実行
- **メモリ使用**: 全入力ポイントの合計分のメモリを使用

### 注意事項

1. すべての入力はポイントデータである必要があります
2. 空のポイントデータはスキップされます
3. メタデータ統合時、異なる型の同名属性がある場合は適切に処理されます
4. 最初の有効な入力データが出力のベースとなり、不要なコピーを回避します
