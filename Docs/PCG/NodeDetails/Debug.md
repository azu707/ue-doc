# Debug

## 概要
Debugノードは、PCGグラフの実行中にデバッグ情報を可視化します。入力データをビューポートに表示し、データの構造と内容を視覚的に確認できます。

- **ノードタイプ**: Debug
- **クラス**: `UPCGDebugSettings`
- **エレメント**: `FPCGDebugElement`

## 機能詳細
このノードは、PCG実行中にデータをエディタビューポートに視覚化します。ポイント、スプライン、ボリューム、サーフェスなどの様々なデータ型をサポートし、デバッグとビジュアル検証を支援します。

### 主な機能
- **データビジュアライゼーション**: 入力データを3Dビューポートに表示
- **複数データ型対応**: Point、Spline、Volume、Surfaceなど
- **ターゲットアクター指定**: 特定のアクターに関連付けてデバッグ表示
- **パススルー**: 入力データを変更せずに出力に転送

### 処理フロー
1. 入力データを取得
2. ターゲットアクターを決定
3. デバッグビジュアライゼーションコンポーネントを作成
4. データを可視化
5. 入力データを出力にパススルー

## プロパティ

### TargetActor
- **型**: TSoftObjectPtr<AActor>
- **カテゴリ**: Settings
- **アクセス**: BlueprintReadWrite
- **PCG_Overridable**: あり
- **説明**: デバッグビジュアライゼーションを関連付けるターゲットアクター。指定しない場合、PCGコンポーネントのオーナーアクターが使用されます

## 使用例

### 基本的なポイントデバッグ
```
// ポイントデータを可視化
入力: ポイントデータ
結果: ビューポートに各ポイントの位置、回転、スケールが表示される
```

### スプラインのデバッグ
```
// スプライン形状を確認
入力: スプラインデータ
結果: スプラインのパスとコントロールポイントが表示される
```

### 処理パイプラインの中間結果確認
```
// フィルタリング後のデータを確認
[Generate Points] -> [Distance Filter] -> [Debug] -> [Static Mesh Spawner]
結果: フィルタリング後にどのポイントが残っているかを視覚的に確認
```

### ターゲットアクター指定
```
// 特定のアクターに関連付けてデバッグ
TargetActor: BP_DebugVisualizationActor
入力: データ
結果: 指定されたアクターにデバッグ表示が関連付けられる
```

### 複数ステージのデバッグ
```
// パイプラインの各ステージにDebugノードを配置
[Generate] -> [Debug 1] -> [Transform] -> [Debug 2] -> [Filter] -> [Debug 3]
結果: 各処理ステージの結果を段階的に確認
```

## 実装の詳細

### 入出力ピン
- **入力ピン**:
  - "In"（任意の型、複数接続可）: デバッグ表示するデータ
- **出力ピン**:
  - "Out"（任意の型）: 入力データをそのまま出力

### 処理の特徴
- **メインスレッド実行**: `CanExecuteOnlyOnMainThread()` が `true` を返すため、メインスレッドでのみ実行
- **キャッシュ不可**: `IsCacheable()` が `false` を返すため、結果はキャッシュされない
- **ベースポイントデータ対応**: `SupportsBasePointDataInputs()` が `true` を返す

### ビジュアライゼーション
エディタのデバッグ描画システムを使用して、以下を表示します：
- ポイント: 位置にマーカー、方向を示す矢印
- スプライン: パスラインとコントロールポイント
- ボリューム: バウンディングボックス
- サーフェス: 境界と形状

### デバッグコンポーネント
デバッグ表示は一時的なコンポーネントとして管理され、再生成時やクリーンアップ時に自動的に削除されます。

## パフォーマンス考慮事項

1. **大量のデータ**: 大量のポイントやスプラインはビューポートのパフォーマンスに影響します
2. **複数のDebugノード**: グラフ内の多数のDebugノードはオーバーヘッドを増加させます
3. **エディタのみ**: Debugノードはエディタでのみ機能し、ランタイムでは無視されます
4. **描画コスト**: 複雑なビジュアライゼーションはエディタのフレームレートに影響します
5. **メモリ使用**: デバッグデータはメモリに保持されます

## 注意事項

1. **エディタ専用**: Debugノードはシッピングビルドでは機能しません
2. **パススルー動作**: Debugノードは入力データを変更しないため、グラフの動作には影響しません
3. **ビジュアライゼーションの制限**: すべてのデータ型が完全に可視化されるわけではありません
4. **パフォーマンス影響**: 最終ビルドではDebugノードを削除または無効化することを推奨します
5. **表示の同期**: ビューポートの更新タイミングによって、表示が遅れる場合があります

## デバッグワークフロー

### 1. データの存在確認
Debugノードを配置して、期待されるデータが生成されているか確認。

### 2. フィルタリング結果の検証
フィルタノードの前後にDebugノードを配置し、どのデータが除外されたか確認。

### 3. トランスフォームの確認
トランスフォーム処理の前後でDebugノードを使用し、変換が正しく適用されているか確認。

### 4. 属性の可視化
Visualize Attributeノードと併用して、データの位置と属性値の両方を確認。

### 5. 段階的なデバッグ
問題が発生している場所を特定するため、パイプラインの各ステージにDebugノードを追加。

## トラブルシューティング

### Debugノードが何も表示しない
- 入力にデータが接続されているか確認
- ビューポートでデバッグ表示が有効になっているか確認
- ターゲットアクターが有効か確認

### 表示が期待と異なる
- 入力データの型を確認
- 前のノードが正しく実行されているか確認
- ビューポートのカメラ位置を調整

### パフォーマンス問題
- 表示するデータ量を減らす
- 不要なDebugノードを削除
- Debugノードを一時的に無効化

## 関連ノード
- **Print String**: テキストメッセージをログに出力
- **Visualize Attribute**: 属性値をビューポートに表示
- **Sanity Check Point Data**: ポイントデータの整合性をチェック
- **Print Grammar**: グラマーの解釈結果を出力

## 実装ファイル
- **ヘッダー**: `Engine/Plugins/PCG/Source/PCG/Public/Elements/PCGDebugElement.h`
- **実装**: `Engine/Plugins/PCG/Source/PCG/Private/Elements/PCGDebugElement.cpp`
