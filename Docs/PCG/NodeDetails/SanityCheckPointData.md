# Sanity Check Point Data

## 概要
Sanity Check Point Dataノードは、ポイントデータの整合性を検証します。ポイント数が指定された範囲内にあるかをチェックし、範囲外の場合は警告またはエラーを出力します。

- **ノードタイプ**: Debug
- **クラス**: `UPCGSanityCheckPointDataSettings`
- **エレメント**: `FPCGSanityCheckPointDataElement`

## 機能詳細
このノードは、生成されたポイントデータの数が期待される範囲内にあるかを検証します。データ生成の妥当性を確認し、異常な状態を早期に検出するのに役立ちます。

### 主な機能
- **ポイント数の検証**: 最小値と最大値の範囲チェック
- **自動エラー検出**: 範囲外の場合に警告を出力
- **パススルー動作**: 入力データを変更せずに出力
- **デバッグ支援**: データ生成パイプラインの整合性確認

### 処理フロー
1. 入力ポイントデータを取得
2. ポイント数をカウント
3. MinPointCountとMaxPointCountの範囲と比較
4. 範囲外の場合、警告またはエラーを出力
5. 入力データを出力にパススルー

## プロパティ

### MinPointCount
- **型**: int32
- **デフォルト値**: 0
- **カテゴリ**: Settings
- **アクセス**: BlueprintReadWrite, EditAnywhere
- **メタ**: PCG_Overridable
- **説明**: ポイントデータに期待される最小ポイント数。実際のポイント数がこれより少ない場合、警告が出力されます

### MaxPointCount
- **型**: int32
- **デフォルト値**: 100
- **カテゴリ**: Settings
- **アクセス**: BlueprintReadWrite, EditAnywhere
- **メタ**: PCG_Overridable
- **説明**: ポイントデータに期待される最大ポイント数。実際のポイント数がこれより多い場合、警告が出力されます

## 使用例

### 基本的なポイント数チェック
```
// 10-50個のポイントが期待される場合
MinPointCount: 10
MaxPointCount: 50
入力: ポイントデータ
結果: ポイント数が範囲外の場合、警告が出力される
```

### フィルタリング後の検証
```
// フィルタリング後にポイントが残っているか確認
[Generate Points] -> [Distance Filter] -> [Sanity Check] -> [Static Mesh Spawner]
MinPointCount: 1
MaxPointCount: 10000
結果: フィルタリングですべてのポイントが除外された場合に検出
```

### 密度チェック
```
// 密度フィルタ後の妥当性確認
MinPointCount: 100
MaxPointCount: 500
// 期待される密度に基づいてポイント数を検証
結果: 異常な密度を早期に検出
```

### パイプラインの各ステージで検証
```
// 処理の各段階でポイント数を確認
[Generate] -> [Sanity Check 1] -> [Filter] -> [Sanity Check 2] -> [Transform]
結果: どの段階で予期しない変化が発生したかを特定
```

### 属性ベースの動的範囲
```
// 属性値に基づいて動的に範囲を設定
MinPointCount: (属性から取得)
MaxPointCount: (属性から取得)
結果: コンテキストに応じた動的な検証
```

## 実装の詳細

### 入出力ピン
- **入力ピン**:
  - "In"（Point、複数接続可）: 検証するポイントデータ
- **出力ピン**:
  - "Out"（Point）: 入力ポイントデータをそのまま出力

### 処理の特徴
- **メインスレッド実行**: `CanExecuteOnlyOnMainThread()` が `true` を返す
- **ベースポイントデータ対応**: `SupportsBasePointDataInputs()` が `true` を返す

### 検証ロジック
```
if (PointCount < MinPointCount):
    警告: "ポイント数が最小値より少ない"
elif (PointCount > MaxPointCount):
    警告: "ポイント数が最大値より多い"
else:
    正常
```

### 警告メッセージ
範囲外の場合、以下のような詳細な警告が出力されます：
- 実際のポイント数
- 期待される範囲
- どの入力ピンからのデータか

## パフォーマンス考慮事項

1. **ポイントカウント**: ポイント数のカウントは高速ですが、非常に大量のポイントでは時間がかかる場合があります
2. **複数入力**: 複数の入力がある場合、各入力を個別にチェックします
3. **オーバーヘッド**: 検証処理自体のオーバーヘッドは最小限です
4. **警告出力**: 警告の出力にはわずかなコストがかかります

## 注意事項

1. **パススルー動作**: このノードはポイントデータを変更しません。フィルタリングは行いません
2. **警告のみ**: 範囲外でも処理は継続されます。エラーで停止はしません
3. **最小値と最大値**: MinPointCountはMaxPointCount以下である必要があります
4. **0ポイント**: MinPointCountが0より大きい場合、空のデータセットは警告を出力します
5. **複数入力の扱い**: 各入力データが個別にチェックされます

## 検証のベストプラクティス

### 1. 重要なステージに配置
データ生成パイプラインの重要なポイントにSanity Checkを配置。

### 2. 合理的な範囲設定
期待される範囲を現実的に設定。範囲が広すぎると有用性が低下。

### 3. 段階的な検証
パイプラインの複数のステージでチェックし、問題の発生場所を特定。

### 4. ドキュメント化
なぜその範囲が期待されるのか、コメントやドキュメントに記録。

### 5. 動的範囲の使用
コンテキストに応じて範囲を動的に調整。

## トラブルシューティング

### 警告が出ない
- 入力にポイントデータが接続されているか確認
- MinPointCountとMaxPointCountが適切に設定されているか確認
- ノードが実行されているか確認

### 常に警告が出る
- 範囲設定が適切か見直す
- 前のノードが期待通りにデータを生成しているか確認
- ポイント数をPrint Stringで確認

### 範囲の決定方法が不明
- テストデータで実際のポイント数を測定
- 期待される密度や分布を計算
- 余裕を持った範囲を設定

## デバッグワークフロー

### 1. データ生成の検証
生成直後にSanity Checkを配置し、基本的な生成が機能しているか確認。

### 2. フィルタリングの影響確認
フィルタノードの前後にSanity Checkを配置し、どれだけフィルタリングされたか確認。

### 3. 変換処理の検証
ポイント数を変更する処理の前後で確認。

### 4. 最終出力の検証
最終的なスポーン前にSanity Checkを配置し、期待されるポイント数か確認。

### 5. 段階的な絞り込み
問題が検出された場合、より細かい範囲で段階的にチェック。

## 検証範囲の設定例

### 厳密な検証
```
MinPointCount: 95
MaxPointCount: 105
// 期待値が100の場合、±5%の許容範囲
```

### 緩やかな検証
```
MinPointCount: 50
MaxPointCount: 500
// より広い範囲で異常値のみ検出
```

### 最小値のみチェック
```
MinPointCount: 1
MaxPointCount: 1000000
// ポイントが存在するかのみ確認
```

### 最大値のみチェック
```
MinPointCount: 0
MaxPointCount: 1000
// ポイント数の上限のみ確認
```

## 関連ノード
- **Print String**: デバッグメッセージを出力
- **Debug**: データを可視化
- **Get Points Count**: ポイント数を属性として取得
- **Attribute Compare**: 属性値の範囲チェック

## 実装ファイル
- **ヘッダー**: `Engine/Plugins/PCG/Source/PCG/Public/Elements/PCGSanityCheckPointData.h`
- **実装**: `Engine/Plugins/PCG/Source/PCG/Private/Elements/PCGSanityCheckPointData.cpp`
