# Select Points

## 概要

**ノードタイプ**: Sampler
**クラス**: UPCGSelectPointsSettings
**エレメント**: FPCGSelectPointsElement

Select Pointsノードは、入力ポイントセットから指定された比率（0-1）のポイントをランダムに選択します。シード値を使用した決定論的なランダム選択により、再現性のあるポイントサブセットの抽出が可能です。

## 機能詳細

Select Pointsノードは、ポイントセットから一部のポイントをランダムにサンプリングするための軽量なフィルタリングツールです。密度ベースのフィルタリングとは異なり、このノードは指定された割合のポイントを均等にランダム選択します。シード値によって選択パターンが決定されるため、同じシードと比率であれば常に同じポイントが選択されます。

主な機能:
- 比率ベースのポイント選択（0-1の範囲）
- シードベースの決定論的ランダム選択
- 高速な処理
- デバッグモードで密度ゼロのポイントを保持可能

## プロパティ

### Ratio
- **型**: float
- **デフォルト値**: 0.1
- **説明**: 選択されるポイントの比率。0.0は何も選択せず、1.0はすべてのポイントを選択します。0.5であれば約半分のポイントが選択されます
- **範囲**: 0.0 - 1.0（クランプされます）
- **オーバーライド可能**: はい

### bKeepZeroDensityPoints（エディタのみ）
- **型**: bool
- **デフォルト値**: false
- **説明**: trueの場合、密度がゼロのポイントも選択プロセスに含めます。通常、密度ゼロのポイントは無視されますが、デバッグ時にこれらのポイントを保持したい場合に有用です
- **オーバーライド可能**: はい
- **カテゴリ**: Settings|Debug
- **注意**: エディタ専用のプロパティです

## 入力ピン

### In
- **型**: Point Data
- **説明**: 選択元のポイントセット
- **デフォルト**: デフォルトのポイント入力ピン

## 出力ピン

### Out
- **型**: Point Data
- **説明**: 選択されたポイントのサブセット
- **デフォルト**: デフォルトのポイント出力ピン

## 使用例

### 例1: ポイント密度の間引き
大量のポイントから10%をランダムに選択してパフォーマンスを向上させる場合:
1. Surface Samplerで密なポイントセットを生成
2. Select Pointsノードで接続:
   - Ratio: 0.1（10%を選択）
3. 元のポイント数の10%のポイントが出力されます

### 例2: バリエーションの追加
複数のSelect Pointsノードを異なる比率で使用してレイヤー化する場合:
1. 元のポイントセット
2. Select Points（Ratio: 0.5）で半分を選択
3. さらにSelect Points（Ratio: 0.5）で追加の半分を選択
4. 最終的に元の25%のポイントが残ります

### 例3: ランダムな配置パターン
複数のオブジェクトタイプをランダムに配置する場合:
1. グリッドポイントを生成
2. 3つのSelect Pointsノードを並列に接続:
   - 1つ目: Ratio 0.3（30%、オブジェクトA用）
   - 2つ目: Ratio 0.3（30%、オブジェクトB用）
   - 3つ目: Ratio 0.4（40%、オブジェクトC用）
3. 各ノードに異なるSeed値を設定
4. 各出力を異なるStatic Mesh Spawnerに接続

### 例4: 段階的な密度減少
距離に応じて段階的にポイント密度を減らす場合:
1. Surface Samplerでポイントを生成
2. Distanceノードで中心からの距離を計算
3. 距離範囲ごとに異なるSelect Pointsを適用:
   - 近距離: Ratio 1.0（すべて保持）
   - 中距離: Ratio 0.5（50%選択）
   - 遠距離: Ratio 0.2（20%選択）

## 実装の詳細

### 処理フロー

1. **入力の取得**: ポイントデータを入力から取得
2. **シードの初期化**: ノードのシード値を使用してランダムジェネレータを初期化
3. **ポイントのイテレーション**: 各ポイントに対して:
   - ポイントの密度をチェック（bKeepZeroDensityPointsがfalseの場合、密度ゼロのポイントをスキップ）
   - シードベースの擬似乱数を生成
   - 生成された乱数がRatio未満であればポイントを選択
4. **出力の構築**: 選択されたポイントを含む新しいポイントデータを生成
5. **出力の送信**: 選択されたポイントセットを出力ピンに送信

### コードスニペット

**シード使用の宣言**:
```cpp
virtual bool UseSeed() const override { return true; }
```

**Base Point Dataサポート**:
```cpp
virtual bool SupportsBasePointDataInputs(FPCGContext* InContext) const { return true; }
```

**シングルプライマリピンループモード**:
```cpp
virtual EPCGElementExecutionLoopMode ExecutionLoopMode(const UPCGSettings* Settings) const override
{
    return EPCGElementExecutionLoopMode::SinglePrimaryPin;
}
```

### アルゴリズムの詳細

Select Pointsノードは、各ポイントに対して独立した確率的選択を行います:

1. ポイントごとに、シードとポイントのインデックスを組み合わせて一意の乱数を生成
2. 生成された乱数（0-1の範囲）がRatioと比較されます
3. 乱数 < Ratio の場合、そのポイントは選択されます
4. この方法により、決定論的でありながらランダムな選択が実現されます

## パフォーマンス考慮事項

1. **軽量な処理**: Select Pointsノードは非常に高速で、ポイントごとに単純な乱数比較のみを行います。大量のポイントに対しても効率的です。

2. **メモリ効率**: 選択されたポイントのみが出力に含まれるため、メモリ使用量が削減されます。

3. **シードの決定性**: 同じシードと比率を使用すれば、常に同じポイントが選択されます。これにより、再現性のある結果が得られます。

4. **密度フィルタリングとの比較**: Density Filterノードよりも高速ですが、密度ベースの制御は行いません。単純にランダムな比率でポイントを選択します。

5. **並列処理**: 複数の入力がある場合、SinglePrimaryPinモードで各入力を順次処理します。各入力は独立して処理されるため、並列化の恩恵を受けられます。

6. **出力サイズの予測**: Ratioが0.1の場合、出力ポイント数は入力の約10%になります。正確な数はランダム選択によって若干変動します。

## 関連ノード

- **Density Filter**: 密度に基づいてポイントをフィルタリング
- **Filter By Attribute**: 属性値に基づいてポイントをフィルタリング
- **Attribute Reduce**: 属性値に基づいてポイントを削減
- **Attribute Partition**: 属性値に基づいてポイントを分割
- **Point Neighborhood**: 近傍ポイントに基づいて選択
- **Bounds Modifier**: バウンドに基づいてポイントをフィルタリング

## 注意事項

- Ratioは0-1の範囲にクランプされます。1より大きい値や負の値を指定しても、適切な範囲に制限されます。
- シード値を変更すると、選択されるポイントのセットが変わります。一貫した結果を得るには、同じシード値を使用してください。
- bKeepZeroDensityPointsはエディタ専用のデバッグ機能です。パッケージビルドには影響しません。
- Select Pointsは確率的選択を行うため、正確にRatio × ポイント数のポイントが選択されるわけではありません。統計的には近い値になりますが、ランダム性により変動します。
- Base Point Data入力をサポートしています。
- 複数のポイントデータ入力がある場合、各入力は個別に処理され、それぞれのシードに基づいて選択されます。
